org: dakshesh
app: zoomin
service: zoomin
frameworkVersion: '3'

provider:
  name: aws
  deploymentMethod: direct
  timeout: 20
  tracing:
    lambda: true
  environment:
    AWS_BUCKET_NAME: zoomin-dev-images
    ACCESS_KEY_ID: AKIAYEUNNGGXZZWD3RES
    SECRET_ACCESS_KEY: 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
    EMAIL_SOURCE_ACCOUNT: 'kashyap.j@crestinfosystems.net'
    # RDS_HOST: zoomin-1.crzgnnp8iqzv.us-west-2.rds.amazonaws.com
    RDS_HOST: 127.0.0.1
    RDS_PORT: 3306
    # RDS_USER: zoomin_dbuser
    RDS_USER: root
    # RDS_PASSWORD: Wk8$b6!xR
    RDS_DB_NAME: zoomin
    JWT_SECRET_KEY: zoominlivesecretkey
    JWT_REFRESH_SECRET_KEY: 2d
    ACCESS_TOKEN_EXPIRY: 1d
    REFRESH_TOKEN_EXPIRY: 1d
    NODE_ENV: production
    RTSP_STREAM_BASE_URL: http://localhost:80

  runtime: nodejs14.x
  stage: dev
  region: us-west-2
  iam:
    role:
      statements:
        - Effect: 'Allow'
          Action: 's3:ListBucket'
          Resource:
            - '*'
        - Effect: Allow
          Action:
            - 's3:GetObject'
            - 's3:PutObject'
          Resource:
            - 'arn:aws:cloudformation:us-west-2:559716053423:stack/zoomin-dev/51663190-43ef-11ed-b517-0625b6019865'
        - Effect: 'Allow'
          Action:
            - 'ses:SendEmail'
            - 'ses:SendRawEmail'
          Resource:
            - 'arn:aws:ses:*'

functions:
  api:
    handler: handler.handler
    events:
      - httpApi: '*'
  getUserDetails:
    handler: handler.handler
    events:
      - httpApi: 'GET /api/users'
  createUser:
    handler: handler.handler
    events:
      - httpApi: 'POST /api/users/createUser'
  login:
    handler: handler.handler
    events:
      - httpApi: 'POST /api/users/login'
  changePassword:
    handler: handler.handler
    events:
      - httpApi: 'PUT /api/users/changePassword'

  setPassword:
    handler: handler.handler
    events:
      - httpApi: 'POST /api/users/setPassword'
  forgetPassword:
    handler: handler.handler
    events:
      - httpApi: 'PUT /api/users/forgetPassword'
  updateUserProfile:
    handler: handler.handler
    events:
      - httpApi: 'PUT /api/users'
  deleteUserProfile:
    handler: handler.handler
    events:
      - httpApi: 'DELETE /api/users'
  uploadImageToS3:
    handler: handler.handler
    events:
      - httpApi: 'POST /api/users/uploadImage'
  deleteImageFromS3:
    handler: handler.handler
    events:
      - httpApi: 'DELETE /api/users/deleteImage'
  disableScheduledMembers:
    handler: cron.disableScheduledFamilyAndChild
    events:
      - schedule: rate(1 day)

plugins:
  - serverless-offline
